{{! template-lint-disable no-unnecessary-concat }}
{{#if select.loading}}
  {{#if loadingMessage}}
    <li class="ember-power-select-option ember-power-select-option--loading-message" role="alert">{{loadingMessage}}</li>
  {{/if}}
{{/if}}

{{#if (readonly renderInVC)}}
  {{#if (and (not multiSelect) (not searchEnabled) allowNull)}}
    <li
      class="ember-power-select-option"
      data-option-index="-1"
      aria-current="{{eq opt select.highlighted}}"
      role={{if (or multiSelect searchEnabled) "option" (if (eq opt select.highlighted) "alert" "option")}}>
      {{or allowNullLabel "..."}}
    </li>
  {{/if}}
  {{!-- by default estimateHeight is 1 & bufferSizeVC is 100 to prevent occluded-content z-index problem --}}
  {{#vertical-collection options
    estimateHeight=(or estimateHeightVC 1)
    bufferSize=(or bufferSizeVC 100)
    staticHeight=(or staticHeightVC false) as |opt index|}}
    {{#if (ember-power-select-is-group opt)}}
      {{#component groupComponent
          group=(readonly opt)
          select=(readonly select)
          extra=(readonly extra)
        }}
        {{#component optionsComponent
          options=(readonly opt.options)
          select=(readonly select)
          groupIndex=(concat groupIndex index ".")
          optionsComponent=(readonly optionsComponent)
          groupComponent=(readonly groupComponent)
          extra=(readonly extra)
          role="group"
          class="ember-power-select-options" as |option|}}
          {{yield option select}}
        {{/component}}
      {{/component}}
    {{else}}
      <li id="{{concat id "-" index}}" class="ember-power-select-option"
        aria-selected="{{ember-power-select-is-selected opt select.selected}}"
        aria-disabled={{ember-power-select-true-string-if-present opt.disabled}}
        aria-current="{{eq opt select.highlighted}}"
        data-option-index="{{groupIndex}}{{index}}"
        role={{if (or multiSelect searchEnabled) "option" (if (eq opt select.highlighted) "alert" "option")}}>
        {{yield opt select}}
      </li>
    {{/if}}
  {{/vertical-collection}}
{{else}}
  {{#if (and (not multiSelect) (not searchEnabled) allowNull)}}
    <li
      class="ember-power-select-option"
      data-option-index="-1"
      aria-current="{{eq opt select.highlighted}}"
      role={{if (or multiSelect searchEnabled) "option" (if (eq opt select.highlighted) "alert" "option")}}>
      {{or allowNullLabel "..."}}
    </li>
  {{/if}}
  {{#each options as |opt index|}}
    {{#if (ember-power-select-is-group opt)}}
      {{#component groupComponent
          group=(readonly opt)
          select=(readonly select)
          extra=(readonly extra)
        }}
        {{#component optionsComponent
          options=(readonly opt.options)
          select=(readonly select)
          groupIndex=(concat groupIndex index ".")
          optionsComponent=(readonly optionsComponent)
          groupComponent=(readonly groupComponent)
          extra=(readonly extra)
          role="group"
          class="ember-power-select-options" as |option|}}
          {{yield option select}}
        {{/component}}
      {{/component}}
    {{else}}
      <li id="{{concat id "-" index}}" class="ember-power-select-option"
        aria-selected="{{ember-power-select-is-selected opt select.selected}}"
        aria-disabled={{ember-power-select-true-string-if-present opt.disabled}}
        aria-current="{{eq opt select.highlighted}}"
        data-option-index="{{groupIndex}}{{index}}"
        role={{if (or multiSelect searchEnabled) "option" (if (eq opt select.highlighted) "alert" "option")}}>
        {{yield opt select}}
      </li>
    {{/if}}
  {{/each}}
{{/if}}